AWSTemplateFormatVersion: "2010-09-09"
Description: Terra Lambdas
Parameters:
    LambdaS3BucketName:
        Type: String
Resources:
    LambdaExecutionRole:
        Type: "AWS::IAM::Role"
        Properties:
          AssumeRolePolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Principal:
                  Service: lambda.amazonaws.com
                Action: sts:AssumeRole
    HelloWorldLambda:
        Type: AWS::Lambda::Function
        Properties:
            Runtime: java8
            Role: !GetAtt [ LambdaExecutionRole, Arn ]
            Handler: hello.Handler::ApiGatewayHandler
            Code:
                S3Bucket: !Ref LambdaS3BucketName
                S3Key: hello.jar
    RestApi:
        Type: AWS::ApiGateway::RestApi
        Properties:
            Name: hello

    ApiGateway:
        Type: AWS::ApiGateway::Method
        Properties:
            AuthorizationType: NONE
            HttpMethod: GET
            ResourceId: !GetAtt RestApi.RootResourceId
            RestApiId: !Ref RestApi
            Integration:
                Type: AWS_PROXY
                IntegrationHttpMethod: GET
                Uri: !Sub arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${HelloWorldLambda.Arn}/
